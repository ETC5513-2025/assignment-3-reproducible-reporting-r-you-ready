---
title: "From Deprivation to Degree: Exploring the Impact of Local Income Levels on Youth Education in England"
author: Group R you OK? 


format: 
  html:
    fontsize: 13pt 
    toc: true
    toc-title: Contents
    theme: cosmo
    citation-hover: true
    crossrefs-hover: true
    code-overflow: wrap
    anchor-sections: true
    df-print: kable
  pdf:
    toc: true
    pdf-engine: xelatex
    toc-title: Contents
    papersize: a4
    linestretch: 1.25
    geometry: 
      - top=20mm
      - bottom=20mm
      - left=20mm
      - right=20mm
    fontsize: 11pt
    df-print: kable
  
knitr:
  opts_chunk:
    out.width: "70%"
    fig.align: "center"
execute: 
  code-overlay:
    margin: "auto"

crossref: 
  fig-title: Figure
  tbl-title: Table
  fig-prefix: Figure
  tbl-prefix: :Table
  labels: arabic

embed-resources: true
fig-cap-location: bottom
number-sections: true
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  results = TRUE,
  message = FALSE,
  out.width = "100%",
  fig.width = 12, 
  fig.height = 6,
  fig.retina = 3,
  fig.pos = "H",
  fig.align  = "center"
  )
```

```{r package loading, include=FALSE}
library(dplyr)
library(ggplot2)
library(readr)
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)
```

# Data Loading

```{r data loading}
edu_df <- read.csv("data/english_education.csv")
```

```{r related variables chosen}
selected_vars <- c( 
  "income_flag",
  "level_3_at_age_18",
  "activity_at_age_19_full_time_higher_education",
  "highest_level_qualification_achieved_by_age_22_level_6_or_above",
  "size_flag"
)

edu_df_selected <- edu_df %>%
  select(all_of(selected_vars))
```

# Methodology

```{r data checkout}
#| label: tbl-proportion_of_income
#| tbl-cap: "Proportion of Each Income Flag Category"

edu_df_selected %>%
  count(income_flag) %>%
  mutate(percentage = round(n / sum(n) * 100, 1)) %>%
  knitr::kable(
    caption = "Proportion of Each Income Flag Category",
    col.names = c("Income Flag", "Count", "Percentage (%)"),
    digits = 1
  )
```

While reviewing the data (@tbl-proportion_of_income), our group discover that there is **missing data** (`NA` value) in the income categories `income_flag`. In order **not to affect the accuracy of the subsequent analysis**, this missing data will not be included in the analysis. Also, since the sample in `Cities` of `income_flag` is **too small and less representative**, it is removed in the subsequent analysis.

```{r data cleaning}
edu_df_clean <- edu_df %>%
  filter(!is.na(income_flag) & income_flag != "Cities") %>%
  mutate(income_flag = factor(income_flag,
                              levels = c("Higher deprivation towns",
                                         "Mid deprivation towns",
                                         "Lower deprivation towns")))
```

```{r}
#| label: tbl-edu_means_by_income
#| tbl-cap: "Mean and SD of Educational Outcomes by Income Group(Cities Excluded)"

table1 <- edu_df_clean %>%
  group_by(income_flag) %>%
  summarise(
    mean_level3 = mean(level_3_at_age_18, na.rm = TRUE),
    sd_level3 = sd(level_3_at_age_18, na.rm = TRUE),
    mean_uni19 = mean(activity_at_age_19_full_time_higher_education, na.rm = TRUE),
    sd_uni19 = sd(activity_at_age_19_full_time_higher_education, na.rm = TRUE),
    mean_level6 = mean(highest_level_qualification_achieved_by_age_22_level_6_or_above, na.rm = TRUE),
    sd_level6 = sd(highest_level_qualification_achieved_by_age_22_level_6_or_above, na.rm = TRUE)
  ) %>%
  rename(
    "Income Group" = income_flag,
    "Mean: Level 3 at 18" = mean_level3,
    "SD: Level 3 at 18" = sd_level3,
    "Mean: HE at 19" = mean_uni19,
    "SD: HE at 19" = sd_uni19,
    "Mean: Level 6 at 22" = mean_level6,
    "SD: Level 6 at 22" = sd_level6
  )


kable(table1, digits = 2) %>%
  kable_styling(full_width = FALSE)

```

@tbl-edu_means_by_income shows that education outcomes improve significantly at all measured stages as income levels rise.

For instance, the mean proportion of individuals achieving Level 3 qualifications by age 18 rises from 41.59% in higher deprivation towns to 57.96% in lower deprivation towns. Similar upward trends are observed for higher education participation at age 19 (27.13% to 40.78%) and for achieving Level 6 qualifications by age 22 (23.99% to 35.68%).

The standard deviations are relatively consistent across groups. This suggests that while variation exists, the overall improvement in outcomes is not due to a small number of high performers.

```{r}
#| label: fig-edu_outcomes_boxplot
#| fig-cap: "Educational Outcomes by Income Group(Cities Excluded)"

edu_long <- edu_df_clean %>%
  pivot_longer(
    cols = c(level_3_at_age_18,
             activity_at_age_19_full_time_higher_education,
             highest_level_qualification_achieved_by_age_22_level_6_or_above),
    names_to = "education_stage",
    values_to = "value"
  )

edu_long$income_flag <- recode(edu_long$income_flag,
  "Higher deprivation towns" = "Higher\ndeprivation\ntowns",
  "Mid deprivation towns" = "Mid\ndeprivation\ntowns",
  "Lower deprivation towns" = "Lower\ndeprivation\ntowns"
)

edu_long$education_stage <- recode(edu_long$education_stage,
  "level_3_at_age_18" = "Level 3 at 18",
  "activity_at_age_19_full_time_higher_education" = "HE at 19",
  "highest_level_qualification_achieved_by_age_22_level_6_or_above" = "Level 6 at 22"
)

ggplot(edu_long, aes(x = income_flag, y = value, fill = income_flag)) +
  geom_boxplot() +
  facet_wrap(~education_stage, scales = "free_y") +
  labs(x = "Income Group", y = "Proportion") +
  theme_minimal()+
  theme(axis.text.x = element_text(size = 9, lineheight = 1.1))
```

@fig-edu_outcomes_boxplot illustrates a clear upward trend in educational attainment as town income levels increase. In all three stages, young people in lower deprivation towns consistently outperform their peers in higher deprivation towns.

Specifically, the median proportions of youth achieving Level 3 qualifications at age 18, participating in full-time higher education at age 19, and attaining Level 6 qualifications by age 22 are all higher in towns with lower deprivation. The interquartile ranges are also narrower in lower deprivation towns, suggesting more consistent performance within these areas.

In contrast, higher deprivation towns exhibit not only lower median outcomes but also greater variability, as reflected by the wider spread of the boxplots and more outliers.

# Result

```{r}
#| label: fig-income-education-by-size
#| fig-cap: "Educational Attainment by Income Deprivation Level and Town Size (Cities Excluded)"
#| fig-subcap:
#| - "Comparison of educational outcomes across income levels and town sizes"

summary_df <- edu_df_clean %>%
  group_by(income_flag, size_flag) %>%
  summarise(
    level3 = mean(level_3_at_age_18, na.rm = TRUE),
    uni19 = mean(activity_at_age_19_full_time_higher_education, na.rm = TRUE),
    level6 = mean(highest_level_qualification_achieved_by_age_22_level_6_or_above, na.rm = TRUE)
  ) %>%
  pivot_longer(
    cols = c(level3, uni19, level6),
    names_to = "education_stage",
    values_to = "mean_value"
  )

summary_df$education_stage <- recode(summary_df$education_stage,
  "level3" = "Level 3 at Age 18",
  "uni19" = "University at 19",
  "level6" = "Level 6+ by Age 22"
)

ggplot(summary_df, aes(x = income_flag, y = mean_value, fill = education_stage)) +
  geom_col(position = "dodge", width = 0.7) +
  facet_wrap(~size_flag) +
  labs(
    x = "Income Deprivation Group",
    y = "Average Proportion",
    fill = "Education Stage"
  ) +
  scale_fill_manual(
    values = c(
      "Level 3 at Age 18" = "#4C72B0",
      "University at 19" = "#55A868",
      "Level 6+ by Age 22" = "#C44E52"
    )
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 9, angle = 45, hjust = 1))
```

As shown in Figure @fig-income-education-by-size, educational attainment increases consistently as income deprivation decreases, across all town sizes. Towns with lower deprivation levels demonstrate the highest average proportions of students achieving Level 3 qualifications at age 18, entering university at age 19, and obtaining Level 6 or higher qualifications by age 22.

This pattern holds for large, medium, and small towns, though the gap between high and low deprivation groups appears most pronounced in small towns, particularly at the Level 6+ stage. In small towns, the difference in university attainment between high and low deprivation groups exceeds 10 percentage points.

These results reinforce a strong association between local income levels and youth educational outcomes, and suggest that deprivation may have an even stronger impact in smaller towns.



# Citation

Wickham H, François R, Henry L, Müller K, Vaughan D (2023). *dplyr: A Grammar of Data Manipulation*. R package version 1.1.4, <https://CRAN.R-project.org/package=dplyr>.

H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.

Wickham H, Hester J, Bryan J (2024). *readr: Read Rectangular Text Data*. R package version 2.1.5, <https://CRAN.R-project.org/package=readr>.

Wickham H, François R, Henry L, Müller K, Vaughan D (2023). *dplyr: A Grammar of Data Manipulation*. R package version 1.1.4, <https://CRAN.R-project.org/package=dplyr>.

Wickham H, Vaughan D, Girlich M (2024). *tidyr: Tidy Messy Data*. R package version 1.3.1, <https://CRAN.R-project.org/package=tidyr>.
